{
  "project": "PLANY App",
  "branchName": "ralph/phase8a-kosztorys-foundation",
  "description": "Phase 8a: Kosztorys Foundation - 3-column layout with sidebar, grouped table, detail panel, add from library (COPY pattern), locked revision support",
  "mode": "feature",
  "baseBranch": "main",
  "userStories": [
    {
      "id": "KSZ-001",
      "title": "Validation schemas for kosztorys",
      "description": "Create lib/validations/kosztorys.ts with Zod schemas following existing patterns (see lib/validations/dostawcy.ts, lib/validations/pozycje.ts). Schemas needed: updateKosztorysPozycjaSchema (nazwa: string min 1 max 500 optional, ilosc: number positive optional, jednostka: string optional, narzut_percent: number min 0 max 100 optional, notatki: string optional), updateSkladowaRSchema (stawka: number min 0, podwykonawca_id: string uuid optional or null), updateSkladowaMSchema (cena: number min 0, dostawca_id: string uuid optional or null), libraryFiltersSchema (search: string optional, branza: string optional, kategoria: string optional, page: coerce number default 1). Export all types.",
      "acceptanceCriteria": [
        "updateKosztorysPozycjaSchema validates partial updates for position fields",
        "updateSkladowaRSchema validates stawka as number >= 0 and optional podwykonawca_id",
        "updateSkladowaMSchema validates cena as number >= 0 and optional dostawca_id",
        "libraryFiltersSchema handles search, branza, kategoria, page",
        "All TypeScript types exported",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Created lib/validations/kosztorys.ts with 4 schemas and exported types",
      "dependsOn": []
    },
    {
      "id": "KSZ-002",
      "title": "Server Actions for kosztorys reads",
      "description": "Create actions/kosztorys.ts following existing patterns (see actions/dostawcy.ts, actions/pozycje.ts). Import createClient from '@/lib/supabase/server'. Use ActionResult<T> type. Implement read actions: 1) getKosztorysData(projektId: string, rewizjaId?: string) - fetches projekt by id from 'projekty', all rewizje for that projekt from 'rewizje' ordered by numer ASC, if no rewizjaId provided use latest unlocked rewizja (or latest overall), then fetch pozycje from 'kosztorys_pozycje_view' filtered by rewizja_id ordered by lp ASC. Return { projekt, rewizje, rewizja, pozycje }. 2) getKosztorysPozycjaDetail(pozycjaId: string) - fetches single pozycja from kosztorys_pozycje, its skladowe_robocizna from kosztorys_skladowe_robocizna ordered by lp, its skladowe_materialy from kosztorys_skladowe_materialy ordered by lp. Also fetch list of podwykonawcy (id, nazwa) and dostawcy (id, nazwa) for dropdowns. Return { pozycja, skladoweR, skladoweM, podwykonawcy, dostawcy }. 3) getLibraryPositions(filters) - fetches from pozycje_biblioteka with optional search (ilike on nazwa), branza filter (left 3 chars of kod using related kategoria), with count of skladowe per position. Export interfaces for all return types: KosztorysData, KosztorysPozycjaDetail, KosztorysPozycjaView (matching kosztorys_pozycje_view columns: id, organization_id, rewizja_id, pozycja_biblioteka_id, lp, nazwa, ilosc, jednostka, narzut_percent, notatki, r_jednostkowy, m_jednostkowy, r_robocizna, m_materialy, r_plus_m, narzut_wartosc, razem).",
      "acceptanceCriteria": [
        "getKosztorysData returns projekt, rewizje list, active rewizja, and pozycje from view",
        "When rewizjaId not provided, selects latest unlocked rewizja (fallback to latest)",
        "getKosztorysPozycjaDetail returns pozycja with skladowe arrays and supplier lists",
        "getLibraryPositions supports search and branza filtering",
        "All interfaces exported (KosztorysData, KosztorysPozycjaView, KosztorysPozycjaDetail)",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Created actions/kosztorys.ts with getKosztorysData, getKosztorysPozycjaDetail, getLibraryPositions",
      "dependsOn": []
    },
    {
      "id": "KSZ-003",
      "title": "Server Actions for kosztorys writes",
      "description": "Add write actions to actions/kosztorys.ts. Use validation schemas from lib/validations/kosztorys.ts. All writes call revalidatePath on the kosztorys route. 1) addPositionFromLibrary(rewizjaId: string, pozycjaBibliotekaId: string) - COPY pattern: a) fetch pozycja from pozycje_biblioteka (nazwa, jednostka), b) get next lp: SELECT COALESCE(MAX(lp),0)+1 from kosztorys_pozycje where rewizja_id, c) fetch rewizja to get organization_id, d) insert into kosztorys_pozycje with pozycja_biblioteka_id reference, ilosc=1 (default), narzut_percent=30, e) fetch skladowe_robocizna from biblioteka_skladowe_robocizna for this pozycja_biblioteka_id, f) for each: find cheapest stawka from stawki_podwykonawcow for this pozycja_biblioteka_id (MIN cena_netto), insert into kosztorys_skladowe_robocizna with opis, norma=norma_domyslna, jednostka, stawka=(cheapest or stawka_domyslna or 0), g) same for materialy: fetch biblioteka_skladowe_materialy, find cheapest cena from ceny_dostawcow by produkt_id (MIN cena_netto), insert into kosztorys_skladowe_materialy with nazwa, norma=norma_domyslna, jednostka, produkt_id, cena=(cheapest or cena_domyslna or 0). 2) updateKosztorysPozycja(id: string, input: unknown) - validate with updateKosztorysPozycjaSchema, update kosztorys_pozycje, revalidate. 3) updateKosztorysSkladowaR(id: string, input: unknown) - validate with updateSkladowaRSchema, update kosztorys_skladowe_robocizna. 4) updateKosztorysSkladowaM(id: string, input: unknown) - validate with updateSkladowaMSchema, update kosztorys_skladowe_materialy. 5) deleteKosztorysPozycje(ids: string[]) - delete from kosztorys_pozycje where id in ids (cascade deletes skladowe). 6) copyRevision(rewizjaId: string) - call supabase.rpc('copy_revision', { source_rewizja_id: rewizjaId }), return new rewizja data.",
      "acceptanceCriteria": [
        "addPositionFromLibrary copies pozycja + all skladowe R/M from library to kosztorys",
        "3-tier price discovery: cheapest supplier price used, fallback to library default, fallback to 0",
        "Auto-assigns lp as max+1 for the rewizja",
        "updateKosztorysPozycja validates and updates position fields",
        "updateKosztorysSkladowaR/M validates and updates component fields",
        "deleteKosztorysPozycje deletes positions by id array (cascade)",
        "copyRevision calls DB function and returns new rewizja",
        "All writes call revalidatePath",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Write actions in same file: addPositionFromLibrary (COPY pattern with 3-tier pricing), updateKosztorysPozycja/SkladowaR/SkladowaM, deleteKosztorysPozycje, copyRevision",
      "dependsOn": ["KSZ-001"]
    },
    {
      "id": "KSZ-004",
      "title": "Kosztorys page route and 3-column layout",
      "description": "Create the kosztorys page at app/(app)/projekty/[projektId]/kosztorys/page.tsx as async Server Component. Remove old placeholder at app/(app)/kosztorys/page.tsx (delete the file and directory). The page reads params.projektId and searchParams.rewizja (optional UUID). Calls getKosztorysData(projektId, rewizjaId). If projekt not found, redirect to /projekty. Passes data to KosztorysView. Create _components/kosztorys-view.tsx as 'use client' component. Layout: header row with breadcrumb (Link to /projekty + projekt.nazwa + 'Kosztorys'), RewizjaSelector on right, '+ Dodaj pozycję' button (amber). Below: flex row with sidebar (w-[260px] shrink-0), main content area (flex-1 with KosztorysSummary on top + KosztorysTable below), SlidePanel for detail. If rewizja.is_locked show LockedBanner. Manage state: detailPanelId (string|null), addFromLibraryOpen (boolean), deleteConfirmId (string|null). Use dark theme classes consistent with existing pages (bg-[#1A1A24]/60, border-white/[0.08], etc). Also update app/(app)/projekty/_components/panels/projekt-detail-panel.tsx: change the disabled 'Otwórz kosztorys' button to an enabled Link that navigates to /projekty/${projektId}/kosztorys.",
      "acceptanceCriteria": [
        "Page at /projekty/[projektId]/kosztorys renders without errors",
        "Old /kosztorys placeholder removed",
        "Server component fetches data and passes to KosztorysView",
        "3-column layout: sidebar 260px, main flex-1, detail panel as SlidePanel",
        "Header shows breadcrumb (Projekty > nazwa > Kosztorys) and rewizja selector",
        "'+ Dodaj pozycję' button visible in header",
        "'Otwórz kosztorys' button in projekt detail panel navigates to kosztorys page",
        "Verify at localhost:3000/projekty - click project, click 'Otwórz kosztorys'",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Page at /projekty/[projektId]/kosztorys with server component, KosztorysView 3-column layout, deleted old /kosztorys stub, enabled 'Otwórz kosztorys' button in projekt detail panel",
      "dependsOn": ["KSZ-002"]
    },
    {
      "id": "KSZ-005",
      "title": "Rewizja selector dropdown",
      "description": "Create app/(app)/projekty/[projektId]/kosztorys/_components/rewizja-selector.tsx as 'use client' component. Props: rewizje array (id, numer, nazwa, is_locked, is_accepted), activeRewizjaId string, projektId string. Render a Select (from @/components/ui/select) with options for each rewizja formatted as 'R{numer}' with Lock icon if is_locked, Check icon if is_accepted. On value change, navigate using router.push to /projekty/[projektId]/kosztorys?rewizja={selectedId}. Show current rewizja as selected value. Style: compact, fits in header row next to breadcrumb.",
      "acceptanceCriteria": [
        "Dropdown shows all rewizje as R0, R1, R2 etc",
        "Lock icon shown for locked rewizje, Check icon for accepted",
        "Changing selection navigates with ?rewizja= searchParam",
        "Current rewizja shown as selected",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Select dropdown with Lock/Check icons, navigates via router.push with ?rewizja= param",
      "dependsOn": ["KSZ-004"]
    },
    {
      "id": "KSZ-006",
      "title": "Sidebar branża tree with filtering",
      "description": "Create app/(app)/projekty/[projektId]/kosztorys/_components/kosztorys-sidebar.tsx as 'use client' component. Props: pozycje array (KosztorysPozycjaView[]), activeFilter object { type: 'all'|'branza'|'kategoria', branzaKod?: string, kategoriaKod?: string }, onFilterChange callback. Build tree from pozycje data: group by first 3 chars of kod (via pozycja_biblioteka relation or extract from pozycje array - need to join with kategorie to get branża/kategoria names). Use a mapping for branża names: BUD='Budowlana', ELE='Elektryczna', SAN='Sanitarna', TEL='Telekomunikacyjna', HVC='Klimatyzacja i wentylacja'. For kategoria names, extract from pozycje data (need kategoria info - may need to extend getKosztorysData to include kategoria names, or derive from pozycja_biblioteka join). Tree items: 'Wszystkie (count)' at top, then branże with counts, expandable to show kategorie with counts. Click branża = filter + toggle expand. Click kategoria = filter to that kategoria. Active item highlighted with amber bg. Include search input at top (filters tree + parent table by nazwa, using onSearchChange callback). Style: dark theme, bg-[#1A1A24]/60, rounded-xl, border-white/[0.08]. If needed, update getKosztorysData in actions/kosztorys.ts to also return the pozycja_biblioteka kod for each kosztorys position (join with pozycje_biblioteka on pozycja_biblioteka_id to get kod). Also join with kategorie to get branża and kategoria names for display.",
      "acceptanceCriteria": [
        "Tree shows 'Wszystkie' with total count at top",
        "Branże listed with position counts, expandable to show kategorie",
        "Click branża filters table and toggles expand",
        "Click kategoria filters to that kategoria",
        "Active filter highlighted with amber/accent color",
        "Search input filters both tree and table by nazwa",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Tree built from pozycje data, groups by branża kod (3 chars) then kategoria (6 chars), search + filter callbacks",
      "dependsOn": ["KSZ-004"]
    },
    {
      "id": "KSZ-007",
      "title": "KPI summary bar",
      "description": "Create app/(app)/projekty/[projektId]/kosztorys/_components/kosztorys-summary.tsx. Props: pozycje array (KosztorysPozycjaView[]), powierzchnia number (from projekt). Calculate from pozycje: wartoscNetto = sum of razem, kosztWlasny = sum of r_plus_m, zysk = wartoscNetto - kosztWlasny, marza = (zysk / wartoscNetto * 100) or 0 if wartoscNetto is 0, cenaMkw = wartoscNetto / powierzchnia or 0, liczbaPozycji = pozycje.length. This component should recalculate based on filtered pozycje (filtered by sidebar). Render as horizontal bar above table with 5 KPI cards: 'Wartość netto' (currency), 'Marża' (percent with 1 decimal), 'Zysk' (currency), 'Cena/m²' (currency), 'Pozycje' (integer). Format currency with Intl.NumberFormat('pl-PL', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' zł'. Style: bg-[#1A1A24]/60, border border-white/[0.08], rounded-xl, grid grid-cols-5 gap-4, each KPI with label (text-xs text-white/50) and value (text-lg font-semibold).",
      "acceptanceCriteria": [
        "Summary bar shows 5 KPIs: Wartość netto, Marża, Zysk, Cena/m², Pozycje",
        "Values calculated from pozycje array (supports filtered subset)",
        "Currency formatted with pl-PL locale and 'zł' suffix",
        "Marża shown as percentage with 1 decimal place",
        "Cena/m² = wartość / powierzchnia",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 4,
      "passes": true,
      "notes": "5 KPI cards: Wartość netto, Marża %, Zysk, Cena/m², Pozycje with pl-PL currency formatting",
      "dependsOn": ["KSZ-004"]
    },
    {
      "id": "KSZ-008",
      "title": "Kosztorys table with branża/kategoria grouping",
      "description": "Create app/(app)/projekty/[projektId]/kosztorys/_components/kosztorys-table.tsx as 'use client' component. Props: pozycje (KosztorysPozycjaView[] - already filtered by sidebar), selectedId (string|null), onSelect (id: string) => void, isLocked boolean. Use TanStack Table (see pozycje-table.tsx for pattern). Columns: Lp (60px, right-align), Kod (120px, monospace text-white/50), Zadanie (flex, font-medium), Ilość (80px, right-align, format without trailing zeros), Jedn. (60px), R (90px, right-align, currency 2 decimals from r_jednostkowy), M (90px, right-align, currency from m_jednostkowy), Narzut % (80px, right-align, integer), Cena/j (100px, right-align, currency, calculated as razem/ilosc), Wartość (110px, right-align, currency bold from razem). GROUP BY branża (first 3 chars of kod) then kategoria (first 6 chars of kod). Render group headers as collapsible rows spanning all columns: branża header shows 'BUD — Budowlana Σ {sumRazem} zł', kategoria header shows indent + 'BUD.03 — {kategoriaName} Σ {sumRazem}'. Use useState for expandedGroups Set. All groups expanded by default. Click header row toggles collapse. Row click calls onSelect. Selected row highlighted with amber border-l-2. Empty state: centered message 'Brak pozycji w kosztorysie' with prompt to add from library. Format all currency with Intl.NumberFormat('pl-PL', { minimumFractionDigits: 2 }) + ' zł'. Need to get kod from the pozycje data - if not available from view, need to extend the query or join. Branża names mapping: {BUD: 'Budowlana', ELE: 'Elektryczna', SAN: 'Sanitarna', TEL: 'Telekomunikacyjna', HVC: 'Klimatyzacja i wentylacja'}.",
      "acceptanceCriteria": [
        "Table renders 10 columns: Lp, Kod, Zadanie, Ilość, Jedn, R, M, Narzut%, Cena/j, Wartość",
        "Positions grouped by branża then kategoria with collapsible headers",
        "Group headers show branża/kategoria name and sum of wartość",
        "All groups expanded by default, click header toggles collapse",
        "Row click calls onSelect, selected row highlighted",
        "Currency formatted with pl-PL locale",
        "Empty state shown when no pozycje",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Custom grouping (not TanStack) with collapsible branża/kategoria headers, 10 columns, empty state",
      "dependsOn": ["KSZ-004", "KSZ-006"]
    },
    {
      "id": "KSZ-009",
      "title": "Add position from library panel",
      "description": "Create app/(app)/projekty/[projektId]/kosztorys/_components/panels/add-from-library-panel.tsx as 'use client'. Props: open, onOpenChange, rewizjaId string, existingPozycjaBibliotekaIds string[] (to mark already added), isLocked boolean. Uses SlidePanel. Content: search input at top, branża dropdown filter (Select with BUD/ELE/SAN/TEL/HVC options + 'Wszystkie'), list of library positions fetched via getLibraryPositions action (call on open and on filter change, use useEffect + startTransition). Each item: checkbox, kod (monospace), nazwa, 'R: N składowe M: N składowe' counts. Items already in rewizja show gray 'Dodano' label (but still selectable - duplicates allowed). Bottom: 'Wybrano: N' count, Cancel + 'Dodaj wybrane' (amber) buttons. On 'Dodaj wybrane': call addPositionFromLibrary for each selected pozycjaBibliotekaId sequentially, show toast success with count, close panel. Disable 'Dodaj wybrane' while adding (useTransition isPending). Wire into kosztorys-view.tsx: '+ Dodaj pozycję' button opens this panel, pass rewizjaId and existingPozycjaBibliotekaIds from pozycje data.",
      "acceptanceCriteria": [
        "SlidePanel opens from '+ Dodaj pozycję' button",
        "Search input filters library positions by name",
        "Branża dropdown filters by industry code",
        "Each position shows checkbox, kod, nazwa, składowe counts",
        "Already-added positions marked with 'Dodano' label",
        "Multi-select with checkboxes, 'Wybrano: N' counter",
        "'Dodaj wybrane' calls addPositionFromLibrary for each selected",
        "Toast shows success with count after adding",
        "Panel hidden when revision is locked",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 6,
      "passes": true,
      "notes": "SlidePanel with search, branża filter, checkbox multi-select, sequential addPositionFromLibrary calls, toast",
      "dependsOn": ["KSZ-003", "KSZ-004"]
    },
    {
      "id": "KSZ-010",
      "title": "Position detail panel with składowe R+M",
      "description": "Create app/(app)/projekty/[projektId]/kosztorys/_components/panels/pozycja-detail-panel.tsx as 'use client'. Props: pozycjaId (string|null), open, onOpenChange, isLocked boolean. On open (pozycjaId changes), fetch data via getKosztorysPozycjaDetail. Show loading spinner while fetching. Layout: header with 'Pozycja #{lp}' + close button, breadcrumb from kod (BUD > Ściany > ...), editable fields: Nazwa (Input), Ilość (Input type=number), Jedn. (Input), Narzut (Input type=number with % suffix). ROBOCIZNA section: list of skladoweR items, each showing opis, stawka as editable inline number input (on blur save via updateKosztorysSkladowaR), norma (read-only), podwykonawca Select dropdown (options from podwykonawcy list, on change save), override indicator dot if value differs from library. Sum line: 'Σ R jednostkowy: {sum} zł/unit'. MATERIAŁY section: same pattern with skladoweM, cena input, dostawca Select. Sum line: 'Σ M jednostkowy: {sum} zł/unit'. Totals section: R+M, Narzut (value), Cena/jedn, WARTOŚĆ. Buttons: 'Resetuj do biblioteki' (only if pozycja_biblioteka_id not null, shows confirm dialog), 'Zapisz' (saves position fields via updateKosztorysPozycja), 'Usuń' (sets deleteConfirmId in parent). When isLocked=true: all inputs disabled, edit buttons hidden, show read-only values.",
      "acceptanceCriteria": [
        "Panel opens on row click with loading state",
        "Shows position info: name, quantity, unit, markup",
        "Robocizna section lists all labor components with editable stawka and podwykonawca dropdown",
        "Materiały section lists all material components with editable cena and dostawca dropdown",
        "Inline edits save on blur via server actions",
        "Sums calculated: R jednostkowy, M jednostkowy, R+M, Narzut, Cena/j, Wartość",
        "'Zapisz' saves position field changes",
        "'Usuń' triggers delete confirmation in parent",
        "All inputs disabled when revision is locked",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 6,
      "passes": true,
      "notes": "Detail panel with inline editable składowe R/M, podwykonawca/dostawca selects, totals section, save/delete buttons, isLocked support",
      "dependsOn": ["KSZ-003", "KSZ-004"]
    },
    {
      "id": "KSZ-011",
      "title": "Delete positions with confirmation and locked banner",
      "description": "Two parts: 1) Delete: Create app/(app)/projekty/[projektId]/kosztorys/_components/panels/delete-confirm-panel.tsx by reusing DeleteConfirmPanel from app/(app)/kategorie/_components/panels/delete-confirm-panel.tsx (import it directly). Wire in kosztorys-view.tsx: when deleteConfirmId is set, open DeleteConfirmPanel with item name from pozycje array. On confirm call deleteKosztorysPozycje([id]), toast success, close panel, clear detailPanelId. 2) Locked banner: Create _components/locked-banner.tsx. Props: rewizja (numer, id), onCopyRevision callback. Render sticky banner at top: Lock icon + 'Rewizja R{numer} jest zamknięta. Edycja zablokowana.' + 'Utwórz nową rewizję' button. On click: call copyRevision(rewizjaId) from actions, redirect to new rewizja via router.push with new rewizja id in searchParams. Wire in kosztorys-view.tsx: show LockedBanner when rewizja.is_locked, hide '+ Dodaj pozycję' button, pass isLocked to table and detail panel.",
      "acceptanceCriteria": [
        "Delete button in detail panel opens confirmation dialog",
        "Confirmation shows position name, warning about irreversibility",
        "Confirm deletes position and closes panels with toast",
        "Locked banner shown when rewizja.is_locked is true",
        "Banner shows revision number and lock message",
        "'Utwórz nową rewizję' copies revision and redirects to new one",
        "'+ Dodaj pozycję' button hidden when locked",
        "Detail panel read-only when locked",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 7,
      "passes": true,
      "notes": "Reused DeleteConfirmPanel from kategorie, LockedBanner with copyRevision redirect, isLocked hides add button and disables inputs",
      "dependsOn": ["KSZ-004", "KSZ-010"]
    },
    {
      "id": "KSZ-012",
      "title": "Seed kosztorys test data",
      "description": "Use Supabase MCP apply_migration tool to create a migration that seeds kosztorys data. Use the existing 'Biuro Acme' project (slug 'biuro-acme-marszalkowska-100') and its rewizje. For the active (unlocked) rewizja, insert 12 kosztorys_pozycje with skladowe. Use INSERT...SELECT pattern with JOINs on natural keys (slug for projekt, numer for rewizja) - never hardcode UUIDs. ON CONFLICT DO NOTHING for idempotency. Positions to seed (matching wireframe mock data): BUD group: 1) Wyburzenia ścian (BUD.01.01.001, 45 m², narzut 30%), 2) Ścianki działowe GK (BUD.03.01.001, 120 m², 30%), 3) Malowanie ścian 2x (BUD.04.03.001, 1850 m², 28%), 4) Wykładzina obiektowa (BUD.05.01.001, 450 m², 30%). ELE group: 5) Korytka kablowe (ELE.01.01.001, 180 mb, 25%), 6) Oświetlenie LED (ELE.02.01.001, 95 szt, 25%), 7) Gniazda elektryczne (ELE.03.01.001, 120 szt, 28%). SAN: 8) Podejścia wod-kan (SAN.01.01.001, 12 szt, 30%), 9) Grzejniki (SAN.02.01.001, 24 szt, 30%). TEL: 10) Punkty LAN (TEL.01.01.001, 80 szt, 25%). HVC: 11) Kanały wentylacyjne (HVC.01.01.001, 320 mb, 22%), 12) Klimatyzacja (HVC.02.01.001, 8 szt, 25%). For each position add 1-3 skladowe_robocizna (opis, stawka 15-45 zł/h, norma 0.05-0.5) and 1-3 skladowe_materialy (nazwa, cena 5-200 zł, norma 0.05-1.5). Link to existing pozycje_biblioteka if matching kod exists, otherwise set pozycja_biblioteka_id to NULL. Use realistic Polish construction terms for opis/nazwa.",
      "acceptanceCriteria": [
        "12 kosztorys positions inserted for the active rewizja of Biuro Acme project",
        "Each position has 1-3 robocizna and 1-3 materialy składowe",
        "Positions span 5 branże: BUD(4), ELE(3), SAN(2), TEL(1), HVC(2)",
        "Uses INSERT...SELECT with JOINs on natural keys (no hardcoded UUIDs)",
        "ON CONFLICT DO NOTHING for idempotency",
        "Migration applies without errors",
        "Data visible at localhost:3000/projekty/[id]/kosztorys",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": true,
      "notes": "12 positions seeded via DO block (PL/pgSQL) for Biuro Acme R2, linked to pozycje_biblioteka by kod, 5 branże with realistic składowe",
      "dependsOn": ["KSZ-003"]
    }
  ]
}
