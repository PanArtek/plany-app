{
  "project": "PLANY App",
  "branchName": "ralph/kategorie-ux-redesign",
  "description": "Redesign Kategorie module: replace card-grid with tree-table layout matching Pozycje style",
  "mode": "feature",
  "baseBranch": "main",
  "userStories": [
    {
      "id": "US-001",
      "title": "Create kategorie-table tree-table component",
      "description": "As a developer, I need a tree-table component that displays kategorie (level 2) and podkategorie (level 3) in flat rows with visual indentation.",
      "acceptanceCriteria": [
        "Create new file: app/(app)/kategorie/_components/kategorie-table.tsx",
        "Component is 'use client'",
        "Props: kategorie: KategoriaNode[], branzaKod: string, searchQuery: string, onAddPodkategoria: (parentId, parentKod, parentNazwa) => void, onEditKategoria: (kategoria, parentKod, parentNazwa) => void, onEditPodkategoria: (kategoria, parentKod, parentNazwa) => void, onDeleteKategoria: (kategoria) => void, onDeletePodkategoria: (kategoria, parentKategoria) => void",
        "Render a div-based table (NOT TanStack Table - simple div structure like the pozycje table header style)",
        "Table header row: Kod | Nazwa | Pod | Akcje - styled with text-white/50 text-xs uppercase tracking-wider border-b border-white/[0.08]",
        "Kategoria rows (level 2): bg-[#1A1A24]/60, kod in font-mono text-sm text-amber-500 showing pelny_kod (e.g. BUD.01), nazwa in text-white text-sm, Pod column shows children count as badge (bg-white/10 text-white/50 text-xs rounded-full px-2 py-0.5) - hide badge when count is 0, Akcje column has 3 ghost icon buttons: Plus (add podkategoria), Pencil (edit), Trash2 (delete)",
        "Podkategoria rows (level 3): bg-white/[0.02], kod in font-mono text-sm text-amber-500/70 with pl-6 indentation showing parent.kod.child.kod (e.g. 01.01), nazwa prefixed with '↳ ' where ↳ is text-white/30 and nazwa is text-white/70 text-sm, no Pod column content, Akcje has 2 ghost buttons: Pencil (edit), Trash2 (delete)",
        "All rows: hover:bg-white/5 transition-colors, border-b border-white/[0.06], cursor-default",
        "Icon buttons: h-7 w-7, icons h-3.5 w-3.5, Trash2 has text-destructive hover:text-destructive",
        "Client-side search filtering using searchQuery prop: if searchQuery is non-empty, filter kategorie - show a kategoria if its kod/nazwa matches OR any of its children match. Show matching podkategorie + always show parent kategoria of matching podkategorie. Case-insensitive includes match on kod and nazwa",
        "Empty state when no kategorie after filtering: centered text-muted-foreground text-sm 'Brak kategorii w tej branży'",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Created div-based tree-table with search filtering, visual indentation, badges, and action buttons",
      "dependsOn": []
    },
    {
      "id": "US-002",
      "title": "Rewrite page.tsx and kategorie-view.tsx for single-page layout",
      "description": "As a user, I want Kategorie to be a single page with branza tabs, search, breadcrumb and tree-table - identical UX pattern to Pozycje.",
      "acceptanceCriteria": [
        "REWRITE app/(app)/kategorie/page.tsx as server component: read 'branza' and 'search' from searchParams (Promise<{branza?: string, search?: string}>), call getKategorieTree(), pass tree data + branza param to KategorieView, wrap in <div className='p-6'>, NO h1 title",
        "DELETE the entire app/(app)/kategorie/[branza]/ directory (rm -rf)",
        "REWRITE app/(app)/kategorie/_components/kategorie-view.tsx completely:",
        "KategorieView is 'use client', wrapped in Suspense (same pattern as PozycjeView in app/(app)/pozycje/_components/pozycje-view.tsx)",
        "Props: initialData: KategoriaNode[], activeBranza: string | undefined",
        "Use useRouter and useSearchParams from next/navigation for URL-based navigation",
        "BREADCRUMB ROW (top): left side shows breadcrumb 'Kategorie' or 'Kategorie / Budowlana' (use BRANZE_NAMES map for full name). Segments separated by '/' in text-white/30, last segment text-foreground, earlier text-white/50, text-sm. Right side: 'Dodaj kategorię' button (Plus icon, only shown when branza is selected)",
        "BRANZA TABS: full-width container bg-[#1A1A24]/40 backdrop-blur-sm border border-white/[0.08] rounded-lg p-1 flex gap-1. Each tab is button with flex-1 px-6 py-2.5 text-sm. Active: bg-amber-500/15 text-amber-500 shadow-[0_0_12px_rgba(245,158,11,0.2)]. Inactive: text-white/50 hover:bg-white/5 hover:text-white/80. Show full names: Budowlana, Elektryczna, Sanitarna, Teletechnika, HVAC. Clicking sets ?branza=KOD in URL (use router.push). Clicking active tab deselects (removes ?branza). EXACTLY like pozycje-filters.tsx tabs",
        "SEARCH INPUT: full-width row below tabs, relative div with Search icon (lucide) absolute left-2, Input with pl-8 and placeholder 'Szukaj po kodzie lub nazwie...'. Local state (useState), NO URL update for search (client-side filtering only)",
        "TABLE: render KategorieTable component (from US-001) with filtered kategorie for active branza. Pass searchQuery from local search state. currentBranza = initialData.find(b => b.kod === activeBranza), kategorie = currentBranza?.children || []",
        "EMPTY STATE: when no branza selected, show centered message 'Wybierz branżę aby wyświetlić kategorie' in div with height calc(100vh - 280px), text-muted-foreground text-sm",
        "CRUD WIRING: use useKategoriaModal hook (from hooks/use-kategoria-modal.ts). 'Dodaj kategorię' button calls modal.openAdd(currentBranza.id, currentBranza.kod, currentBranza.nazwa, 2). Table onAddPodkategoria calls modal.openAdd(parentId, parentKod, parentNazwa, 3). Table onEditKategoria calls modal.openEdit(kategoria, branzaKod, branzaNazwa, 2). Table onEditPodkategoria calls modal.openEdit(kategoria, parentFullKod, parentNazwa, 3). Render KategoriaFormPanel with modal.state props (same as current). For delete: use local state for delete panel (selectedForDelete, deleteModalOpen). Table onDeleteKategoria/onDeletePodkategoria set the selected item and open DeleteConfirmPanel. Reuse DeleteConfirmPanel from ./panels/delete-confirm-panel.tsx",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Rewrote page.tsx as server component with searchParams, deleted [branza] dir, rewrote kategorie-view.tsx with Suspense wrapper, URL-based branza tabs, breadcrumb, search, delete confirm panel",
      "dependsOn": ["US-001"]
    },
    {
      "id": "US-003",
      "title": "Remove old unused components and clean up store",
      "description": "As a developer, I need to remove the old card-grid components and clean up the Zustand store since expandedIds is no longer needed.",
      "acceptanceCriteria": [
        "DELETE these files: app/(app)/kategorie/_components/branze-grid.tsx, app/(app)/kategorie/_components/branza-tile.tsx, app/(app)/kategorie/_components/kategoria-card.tsx, app/(app)/kategorie/_components/kategorie-list.tsx, app/(app)/kategorie/_components/branza-tabs.tsx",
        "UPDATE stores/kategorie-ui-store.ts: remove expandedIds, toggleExpanded, collapseAll from interface and store. Keep ONLY the BranzaKod type export. If the store itself is no longer imported anywhere (check with grep), delete the whole file but keep BranzaKod type - move it to a types file or inline it where needed",
        "Check all files for broken imports referencing deleted components (grep for branze-grid, branza-tile, kategoria-card, kategorie-list, branza-tabs, expandedIds, toggleExpanded, collapseAll) and fix any found",
        "npm run build passes without errors",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Deleted branze-grid, branza-tile, kategoria-card, kategorie-list, branza-tabs. Simplified store to just BranzaKod type export. No broken imports.",
      "dependsOn": ["US-002"]
    },
    {
      "id": "US-004",
      "title": "Final verification and build",
      "description": "As a developer, verify the complete Kategorie redesign works end-to-end.",
      "acceptanceCriteria": [
        "npm run build passes without errors",
        "Verify /kategorie: breadcrumb shows 'Kategorie', empty state 'Wybierz branżę' shown, no branza tiles grid",
        "Verify clicking BUD tab: breadcrumb updates to 'Kategorie / Budowlana', tree-table shows kategorie with podkategorie indented",
        "Verify podkategorie rows are visually indented with ↳ prefix and dimmer text",
        "Verify 'Dodaj kategorię' button appears when branza is selected",
        "Verify clicking '+' on a kategoria row opens form panel for adding podkategoria",
        "Verify clicking edit on a row opens form panel for editing",
        "Verify clicking delete on a row opens delete confirmation panel",
        "Verify search filters kategorie and podkategorie by name/kod in real-time",
        "Verify clicking active branza tab deselects it (returns to empty state)",
        "No console errors",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 4,
      "passes": true,
      "notes": "All acceptance criteria verified in browser. Build passes. 0 console errors. Breadcrumb, tabs, search, tree-table, add/edit/delete panels all working.",
      "dependsOn": ["US-003"]
    }
  ]
}
