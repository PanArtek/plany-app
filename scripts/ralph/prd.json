{
  "project": "PLANY App",
  "branchName": "ralph/phase3b-skladowe",
  "description": "Phase 3B: CRUD for składowe (robocizna + materiały) in pozycja detail panel with inline editing",
  "mode": "feature",
  "baseBranch": "ralph/phase3a-kategorie",
  "userStories": [
    {
      "id": "SKL-001",
      "title": "Validation schemas for składowe",
      "description": "As a developer, I need Zod validation schemas for składowe robocizna and materiały forms.",
      "acceptanceCriteria": [
        "Create lib/validations/skladowe.ts",
        "createSkladowaRobociznaSchema: opis (string 1-500, required), norma_domyslna (number > 0, required), jednostka (enum h|szt|kpl, default h), stawka_domyslna (number >= 0, nullable optional)",
        "createSkladowaMaterialSchema: nazwa (string 1-255, required), norma_domyslna (number > 0, required), jednostka (enum m²|mb|szt|l|kg|kpl, nullable optional), cena_domyslna (number >= 0, nullable optional)",
        "Export TypeScript types: CreateSkladowaRobociznaInput, CreateSkladowaMaterialInput",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": "",
      "dependsOn": []
    },
    {
      "id": "SKL-002",
      "title": "Server Actions CRUD for składowe",
      "description": "As a developer, I need server actions to create, update, and delete składowe robocizna and materiały.",
      "acceptanceCriteria": [
        "Create actions/skladowe.ts with 'use server'",
        "createSkladowaRobocizna(pozycjaId, data): INSERT with auto-increment lp (MAX(lp)+1 for pozycja), revalidatePath('/pozycje')",
        "updateSkladowaRobocizna(id, data): UPDATE by id, revalidatePath('/pozycje')",
        "deleteSkladowaRobocizna(id): DELETE by id, revalidatePath('/pozycje')",
        "createSkladowaMaterial(pozycjaId, data): same pattern for materiały",
        "updateSkladowaMaterial(id, data): UPDATE materiały",
        "deleteSkladowaMaterial(id): DELETE materiały",
        "All actions return { success: true, data } or { success: false, error: string }",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": "",
      "dependsOn": ["SKL-001"]
    },
    {
      "id": "SKL-003",
      "title": "Modal for składowa robocizny",
      "description": "As a user, I want a modal to add or edit a składowa robocizny with fields: opis, norma, jednostka, stawka.",
      "acceptanceCriteria": [
        "Create app/(app)/pozycje/_components/modals/skladowa-robocizna-modal.tsx",
        "Props: open, onOpenChange, mode ('add'|'edit'), pozycjaId, skladowa? (for edit)",
        "Form fields: opis (Input), norma_domyslna (Input type=number), jednostka (Select: h/szt/kpl), stawka_domyslna (Input type=number, optional)",
        "On submit: call createSkladowaRobocizna or updateSkladowaRobocizna",
        "Show toast on success/error",
        "Close modal on success",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": false,
      "notes": "",
      "dependsOn": ["SKL-002"]
    },
    {
      "id": "SKL-004",
      "title": "Modal for składowa materiałowa",
      "description": "As a user, I want a modal to add or edit a składowa materiałowa with fields: nazwa, norma, jednostka, cena.",
      "acceptanceCriteria": [
        "Create app/(app)/pozycje/_components/modals/skladowa-material-modal.tsx",
        "Props: open, onOpenChange, mode ('add'|'edit'), pozycjaId, skladowa? (for edit)",
        "Form fields: nazwa (Input), norma_domyslna (Input type=number), jednostka (Select: m²/mb/szt/l/kg/kpl), cena_domyslna (Input type=number, optional)",
        "On submit: call createSkladowaMaterial or updateSkladowaMaterial",
        "Show toast on success/error",
        "Close modal on success",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": false,
      "notes": "",
      "dependsOn": ["SKL-002"]
    },
    {
      "id": "SKL-005",
      "title": "Interactive SkladoweSection with buttons",
      "description": "As a user, I want to see [+ Dodaj], [edit], [delete] buttons in the składowe sections.",
      "acceptanceCriteria": [
        "Modify app/(app)/pozycje/_components/skladowe-section.tsx",
        "Add props: editable (boolean, default true), onAdd, onEdit(item), onDelete(item)",
        "Show [+ Dodaj] button in section header when editable",
        "Show edit (Pencil) and delete (Trash2) icons on each item row when editable",
        "Display norma × stawka/cena info on each row (e.g. '1.0 h × 12.50 zł/h')",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": false,
      "notes": "",
      "dependsOn": ["SKL-003", "SKL-004"]
    },
    {
      "id": "SKL-006",
      "title": "Integration in PozycjaDetailPanel",
      "description": "As a user, I want to add/edit/delete składowe from the pozycja detail panel with working modals and confirmations.",
      "acceptanceCriteria": [
        "Modify app/(app)/pozycje/_components/pozycja-detail-panel.tsx",
        "Add state: modalType ('robocizna'|'material'|null), modalMode ('add'|'edit'), editingSkladowa, deleteDialogOpen, deletingSkladowa",
        "Create app/(app)/pozycje/_components/modals/delete-skladowa-dialog.tsx with confirmation",
        "Pass onAdd, onEdit, onDelete callbacks to both SkladoweSection components",
        "Wire up SkladowaRobociznaModal for robocizna section",
        "Wire up SkladowaMaterialModal for materiały section",
        "Wire up DeleteSkladowaDialog - call deleteSkladowaRobocizna or deleteSkladowaMaterial based on type",
        "Verify at localhost:3000/pozycje - select a pozycja, add/edit/delete składowe works",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": false,
      "notes": "",
      "dependsOn": ["SKL-005"]
    }
  ]
}
