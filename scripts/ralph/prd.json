{
  "project": "PLANY App",
  "branchName": "ralph/phase3a-kategorie",
  "description": "Phase 3a-UX: Kategorie modal UX improvements - auto-suggestion of next kod, live preview of full kod, parent info display",
  "mode": "feature",
  "baseBranch": "main",
  "userStories": [
    {
      "id": "KAT-UX-001",
      "title": "Server Action getNextKod",
      "description": "As a developer, I need a server action that suggests the next available kod for a given parent category.",
      "acceptanceCriteria": [
        "Add getNextKod(parentId: string | null) to actions/kategorie.ts",
        "Query siblings by parent_id, find first gap in 01-99 sequence",
        "Return '01' if no siblings exist",
        "Handle both null parentId (for branża level) and string parentId",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Fixed to handle null parentId using .is('parent_id', null) for branża level",
      "dependsOn": []
    },
    {
      "id": "KAT-UX-002",
      "title": "Hook useKategoriaModal",
      "description": "As a developer, I need a hook to manage modal state and fetch suggested kod on open.",
      "acceptanceCriteria": [
        "Create hooks/use-kategoria-modal.ts",
        "State: open, mode, poziom, parentId, parentPath, parentNazwa, suggestedKod, kategoria",
        "openAdd(parentId, parentKod, parentNazwa, poziom): fetches suggestedKod via getNextKod",
        "openEdit(kategoria, parentKod, parentNazwa, poziom): sets state without fetch",
        "close(): resets state",
        "Export ModalState type",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": "",
      "dependsOn": ["KAT-UX-001"]
    },
    {
      "id": "KAT-UX-003",
      "title": "Modal z auto-sugestią",
      "description": "As a user, I want to see parent info, auto-suggested kod, and live full kod preview when adding/editing categories.",
      "acceptanceCriteria": [
        "Refactor kategoria-form-modal.tsx to accept new props: parentPath, parentNazwa, suggestedKod",
        "Show disabled field with parent info (e.g. 'BUD - Budowlana')",
        "Auto-fill kod field with suggestedKod in add mode",
        "Show live preview of full kod (parentPath + '.' + kod)",
        "Show suggestion hint text below kod input",
        "Verify at localhost:3000/kategorie - modal shows correctly",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": false,
      "notes": "",
      "dependsOn": ["KAT-UX-002"]
    },
    {
      "id": "KAT-UX-004",
      "title": "Integracja w KategorieView",
      "description": "As a developer, I need to integrate the new modal hook in KategorieView and remove old modal state management.",
      "acceptanceCriteria": [
        "Update KategorieView to use useKategoriaModal hook",
        "Remove old formModal state management",
        "Update KategoriaCard to call hook methods instead of setFormModal",
        "Single modal instance controlled by hook",
        "Verify at localhost:3000/kategorie - add/edit works from any level",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": false,
      "notes": "",
      "dependsOn": ["KAT-UX-003"]
    }
  ]
}
